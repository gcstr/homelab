docker:
  context: hetzner-two
  identifier: homeserver

sops:
  age:
    key_file: ${AGE_KEY_FILE}

secrets:
  sops:
    - secrets.env

stacks:
  gcstr:
    root: ./gustavocastro
  traefik:
    root: ./traefik
    secrets:
      sops:
        - secrets.env
  coredns:
    root: ./coredns
  bitwarden:
    root: ./bitwarden
  uptime-kuma:
    root: ./uptime
  beszel:
    root: ./beszel
    secrets:
      sops:
        - secrets.env

filesets:
  gcstr:
    source: ./gustavocastro/public
    target_volume: gcstr
    target_path: /usr/share/nginx/html
    restart_services:
      - web
  traefik_config:
    source: ./traefik/config
    target_volume: traefik_config
    target_path: /etc/traefik
    restart_services:
      - traefik
  traefik_dynamic:
    source: ./traefik/dynamic
    target_volume: traefik_dynamic
    target_path: /dynamic
  coredns_config:
    source: ./coredns/config
    target_volume: coredns_config
    target_path: /config
    restart_services:
      - coredns
    ownership:
      file_mode: "755"
      preserve_existing: false

networks:
  traefik:

volumes:
  bitwarden:
  bitwarden_logs:
  uptime-kuma:
  coredns_config:
  beszel_agent_data:
  beszel_socket:
  beszel_data:
